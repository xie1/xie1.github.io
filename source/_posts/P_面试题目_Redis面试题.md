
##P_面试题目_Redis面试题

###1、项目中缓存是如何使用的？为什么要用缓存？缓存使用不当会造成什么后果？——》已理解
	1、面试官心理分析：
		这个问题，互联网公司必问，要是一个人连缓存都不太清楚，那确实比较尴尬。只要问到缓存，上来第一个问题，肯定是先问问你项目哪里用了缓存？为啥要用？不用行不行？如果用了以后可能会有什么不良的后果？这就是看看你对缓存这个东西背后有没有思考，如果你就是傻乎乎的瞎用，没法给面试官一个合理的解答，那面试官对你印象肯定不太好，觉得你平时思考太少，就知道干活儿

	2、面试题的剖析
		1、项目中缓存是如何使用的？
			主要有可以参考苗木超市的列表和采购单列表，分词的词库放于缓存中
		2、为什么要用缓存？
			高性能，高并发
			1、高性能：苗木超市的列表（慢查询，数据变化不大的，就放于缓存中）
			2、高并发：缓存是走内存的，内存天然就支撑高并发
		3、缓存使用不当会造成后果？
			1、缓存和数据库双写不一致
			2、缓存雪崩，缓存穿透
			3、缓存并发竞争	

![Alt text](./1559378468429.png)

###2、redis和memcached有什么区别？redis的线程模型是什么？为什么redis单线程却能支持高并发？——》已理解
	1、面试官的心理分析：
	 这个是问 redis 的时候，最基本的问题吧，redis 最基本的一个内部原理和特点，就是 redis 实际上是个单线程工作模型，你要是这个都不知道，那后面玩儿 redis 的时候，出了问题岂不是什么都不知道？
	
	还有可能面试官会问问你 redis 和 memcached 的区别，但是 memcached 是早些年各大互联网公司常用的缓存方案，但是现在近几年基本都是 redis，没什么公司用 memcached 了。

	2、面试题剖析：
		要理解：
			1、什么导致的redis单线程？描述下文件事件驱动处理器的过程。
			2、描述一下客户端与redis建立一次通信过程/
	redis 和 memcached 有啥区别？
	 1、redis 支持复杂的数据结构
	 redis 相比 memcached 来说，拥有更多的数据结构，能支持更丰富的数据操作。如果需要缓存能够支持更复杂的结构和操作， redis会是不错的选择。
	
	2、redis 原生支持集群模式
	 在 redis3.x 版本中，便能支持 cluster 模式，而 memcached 没有原生的集群模式，需要依靠客户端来实现往集群中分片写入数据。
	
	3、性能对比
	 由于 redis 只使用单核，而 memcached 可以使用多核，所以平均每一个核上 redis 在存储小数据时比 memcached 性能更高。而在 100k 以上的数据中，memcached 性能要高于 redis。虽然 redis 最近也在存储大数据的性能上进行优化，但是比起 memcached，还是稍有逊色。
![Alt text](./1559381894148.png)
![Alt text](./1559381907310.png)


###3、redis 都有哪些数据类型？分别在哪些场景下使用比较合适？——》已理解
	1、面试官心理分析：
		其实问这个问题，主要有两个原因：
	看看你到底有没有全面的了解 redis 有哪些功能，一般怎么来用，啥场景用什么，就怕你别就会最简单的 KV 操作；
	看看你在实际项目里都怎么玩儿过 redis
	2、面试题剖析
![Alt text](./1559382757442.png)
![Alt text](./1559382777390.png)
![Alt text](./1559382798389.png)
![Alt text](./1559382807586.png)

###4、redis的过期策略有哪些？内存淘汰机制有哪些？手写一些LRU代码实现？——》已理解
	1、面试官心理分析
		如果你连这个问题都不知道，上来就懵了，回答不出来，那线上你写代码的时候，想当然的认为写进 redis 的数据就一定会存在，后面导致系统各种 bug，谁来负责？

	常见的有两个问题：
	
	往 redis 写入的数据怎么没了？
	可能有同学会遇到，在生产环境的 redis 经常会丢掉一些数据，写进去了，过一会儿可能就没了。我的天，同学，你问这个问题就说明 redis 你就没用对啊。redis 是缓存，你给当存储了是吧？
	
	啥叫缓存？用内存当缓存。内存是无限的吗，内存是很宝贵而且是有限的，磁盘是廉价而且是大量的。可能一台机器就几十个 G 的内存，但是可以有几个 T 的硬盘空间。redis 主要是基于内存来进行高性能、高并发的读写操作的。
	
	那既然内存是有限的，比如 redis 就只能用 10G，你要是往里面写了 20G 的数据，会咋办？当然会干掉 10G 的数据，然后就保留 10G 的数据了。那干掉哪些数据？保留哪些数据？当然是干掉不常用的数据，保留常用的数据了。
	
	数据明明过期了，怎么还占用着内存？
	这是由 redis 的过期策略来决定

	2、面试题剖析
![Alt text](./1559386816035.png)
![Alt text](./1559386843881.png)
![Alt text](./1559386856819.png)
###5、如何保证 Redis 高并发、高可用？Redis 的主从复制原理能介绍一下么？Redis 的哨兵原理能介绍一下么？——》已理解
![Alt text](./1562407759952.png)

###6、Redis 的持久化有哪几种方式？不同的持久化机制都有什么优缺点？持久化机制具体底层是如何实现的？——》已理解
	持久化：
	1、RDB：生成快照，是对redis中的数据执行周期性持久化
	2、AOF：AOF机制对每条写命令追加至AOF文件，当redis重启时，通过回放AOF日志中的写指令来重新构建整个数据集。
	
	优缺点：
	1、RDB优缺点
		1、会生成多个数据文件，非常适合做冷备
		2、对redis对外提供读写服务，影响小，可以使redis保持高性能
		3、基于RDB数据文件重启和恢复redis进程，更加快速
		4、会丢失部分时间间隔段数据
		5、如果文件特别大，服务暂停时间长
	2、AOF优缺点
		1、可以保护数据不丢失
		2、没有任何磁盘寻址，写入性能非常高
		3、AOF日志文件的命令可以通过非常可读的方式进行记录，这个特性适合做灾难性误删紧急恢复
		4、同一个数据，AOF日志比较大
	
	如何选择哪种持久化方式：
	同事开启两种持久化，用AOF保证数据不丢失，用RDB来做不同程度的冷备


![Alt text](./1562407804361.png)
![Alt text](./1562407815547.png)
![Alt text](./1562407831368.png)
###7、Redis 集群模式的工作原理能说一下么？在集群模式下，Redis 的 key 是如何寻址的？分布式寻址都有哪些算法？了解一致性 hash 算法吗？如何动态增加和删除一个节点？
![Alt text](./1562407891351.png)
![Alt text](./1562407907751.png)
![Alt text](./1562407927443.png)
![Alt text](./1562407951802.png)
![Alt text](./1562407968807.png)
![Alt text](./1562407995248.png)
![Alt text](./1562408008327.png)
![Alt text](./1562408015948.png)


###8、如何保证缓存与数据库的双写一致性？
![Alt text](./1562408536656.png)
![Alt text](./1562408553593.png)
![Alt text](./1562408570736.png)
![Alt text](./1562408590963.png)



###9、了解什么是 redis 的雪崩、穿透和击穿？Redis 崩溃之后会怎么样？系统该如何应对这种情况？如何处理 Redis 的穿透？——》已理解

	1、缓存雪崩
		1、缓存机器挂了，请求全部落到数据库，数据库无法承受而挂掉
		解决办法：
		1、事前：redis高可用，主从+哨兵，redis cluster，避免全盘崩溃
		2、事中：本地缓存+限流，降级，避免mysql被打死
		3、事后：redis持久化，一旦重启，自动从磁盘恢复，加速恢复缓存数据
	2、缓存穿透
		1、被恶意请求缓存中不存在的数据，导致请求全部落到数据库
		解决办法：
			只要没有查到的，就写入一个空值到缓存中，然后设置一个过期时间
	3、缓存击穿
		1、某个key非常热点，访问频繁，当key失效瞬间，大量请求击穿缓存
		解决办法:
			设置热点永不过期，或通过redis和zookeeper实现互斥锁

![Alt text](./1562408170976.png)
![Alt text](./1562408201632.png)
![Alt text](./1562408211523.png)
![Alt text](./1562408230320.png)

###10、Redis 的并发竞争问题是什么？如何解决这个问题？了解 Redis 事务的 CAS 方案吗？——》已理解
	并发竞争问题：
	1、多客户端同时并发写一个key。
	
	解决方案：
	1、通过基于zookeeper实现分布式锁
	2、通过CAS类乐观方案
		1、你要写缓存数据，都是从mysql里查出来，都将吸入mysql中，写入mysql中的时候必须保存一个时间戳
		从mysql查出来的时候，时间戳也查出来。
		2、每次都要写之前，先判断一下当前这个value的时间戳是否比缓存的value要新，如果新的话，可以写。不然用旧的数据覆盖新的数据


![Alt text](./1562408654827.png)

###11、生产环境中的 Redis 是怎么部署的？——》已理解
	我们项目是单机

	但是对于Redis上的部署还是有些了解的。。。。。
![Alt text](./1562408730187.png)
