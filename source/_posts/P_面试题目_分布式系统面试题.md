---
title: 分布式系统面试题
date: 2019-11-16 10:17:59
tags: 
categories: 
---
#一、*思维导图*
#*总知识点*
###一、分布式系统
####1.1、为什么要进行系统拆分——》已理解
#####1.1.1、为什么要进行系统拆分？如何进行系统拆分？拆分后不用 dubbo 可以吗？
	1、面试官心理分析：
		从这个问题开始就进行分布式系统的环节的提问
	

2、面试题剖析
	为什么要将系统进行拆分？
	1、业务复杂，项目庞大，不利于项目的开发，维护，扩展等，测试上线。
	2、系统拆分，我们主要是先结合业务进行一轮粗拆分，（苗木，采购，支付，用户，合同，消息等几块）
	3、可以不使用。但是考虑到dubbo是一个rpc解决。

####1.2、分布式服务框架（Dubbo）
#####1.2.1、说一下的 dubbo 的工作原理？注册中心挂了可以继续通信吗？说说一次 rpc 请求的流程？——》已理解
	1、面试官心理分析：
	MQ、ES、Redis、Dubbo，上来先问你一些思考性的问题、原理，比如 kafka 高可用架构原理、es 分布式架构原理、redis 线程模型原理、Dubbo 工作原理；之后就是生产环境里可能会碰到的一些问题，因为每种技术引入之后生产环境都可能会碰到一些问题；再来点综合的，就是系统设计，比如让你设计一个 MQ、设计一个搜索引擎、设计一个缓存、设计一个 rpc 框架等等。
	

那既然开始聊分布式系统了，自然重点先聊聊 dubbo 了，毕竟 dubbo 是目前事实上大部分公司的分布式系统的 rpc 框架标准，基于 dubbo 也可以构建一整套的微服务架构。但是需要自己大量开发。

当然去年开始 spring cloud 非常火，现在大量的公司开始转向 spring cloud 了，spring cloud 人家毕竟是微服务架构的全家桶式的这么一个东西。但是因为很多公司还在用 dubbo，所以 dubbo 肯定会是目前面试的重点，何况人家 dubbo 现在重启开源社区维护了，捐献给了 apache，未来应该也还是有一定市场和地位的。

既然聊 dubbo，那肯定是先从 dubbo 原理开始聊了，你先说说 dubbo 支撑 rpc 分布式调用的架构啥的，然后说说一次 rpc 请求 dubbo 是怎么给你完成的，对吧

2、面试题剖析：

![Alt text](./1559445020630.png)
![Alt text](./1559445035791.png)
#####1.2.2、dubbo 支持哪些通信协议？支持哪些序列化协议？说一下 Hessian 的数据结构？PB 知道吗？为什么 PB 的效率是最高的？——》已理解
	1、面试官心理分析：
		上一个问题，说说 dubbo 的基本工作原理，那是你必须知道的，至少要知道 dubbo 分成哪些层，然后平时怎么发起 rpc 请求的，注册、发现、调用，这些是基本的。
	

接着就可以针对底层进行深入的问问了，比如第一步就可以先问问序列化协议这块，就是平时 RPC 的时候怎么走的？
2、面试题剖析：

![Alt text](./1559447305987.png)
![Alt text](./1559447321806.png)
![Alt text](./1559447340092.png)
#####1.2.3、dubbo 负载均衡策略和集群容错策略都有哪些？动态代理策略呢？	——》已理解	
	1、面试官心理分析：
			继续深问吧，这些都是用 dubbo 必须知道的一些东西，你得知道基本原理，知道序列化是什么协议，还得知道具体用 dubbo 的时候，如何负载均衡，如何高可用，如何动态代理。
	

说白了，就是看你对 dubbo 熟悉不熟悉：
	1、dubbo 工作原理：服务注册、注册中心、消费者、代理通信、负载均衡；
	2、网络通信、序列化：dubbo 协议、长连接、NIO、hessian 序列化协议；
	3、负载均衡策略、集群容错策略、动态代理策略：dubbo 跑起来的时候一些功能是如何运转的？怎么做负载均衡？怎么做集群容错？怎么生成动态代理？
	4、dubbo SPI 机制：你了解不了解 dubbo 的 SPI 机制？如何基于 SPI 机制对 dubbo 进行扩展？

2、面试题剖析：

![Alt text](./1559447845477.png)
![Alt text](./1559447866588.png)
![Alt text](./1559447878504.png)
#####1.2.4、dubbo 的 spi 思想是什么？——》已理解	类似jdbc思想
	1、面试官心理分析
	继续深入问呗，前面一些基础性的东西问完了，确定你应该都 ok，了解 dubbo 的一些基本东西，那么问个稍微难一点点的问题，就是 spi，先问问你 spi 是啥？然后问问你 dubbo 的 spi 是怎么实现的？
	其实就是看看你对 dubbo 的掌握如何

2、面试题剖析：

![Alt text](./1559455789788.png)
![Alt text](./1559455812568.png)
![Alt text](./1559455827839.png)
![Alt text](./1559455842115.png)

#####1.2.5、如何基于 dubbo 进行服务治理、服务降级、失败重试以及超时重试？——》已理解
	主要是配置文件的设置
		1、服务治理
			1、查看服务之间链路的调用情况
			2、统计分析服务之间的调用的时间和访问压力
		2、服务降级
			1、自己实现服务降级接口，在配置接口时候，配上
		3、失败重试与超时重试
			1、配置重试次数和超时时间

1、面试官心理分析：
服务治理，这个问题如果问你，其实就是看看你有没有服务治理的思想，因为这个是做过复杂微服务的人肯定会遇到的一个问题。

服务降级，这个是涉及到复杂分布式系统中必备的一个话题，因为分布式系统互相来回调用，任何一个系统故障了，你不降级，直接就全盘崩溃？那就太坑爹了吧。

失败重试，分布式系统中网络请求如此频繁，要是因为网络问题不小心失败了一次，是不是要重试？

超时重试，跟上面一样，如果不小心网络慢一点，超时了，如何重试？
2、面试题剖析：

![Alt text](./1559461510217.png)
![Alt text](./1559461528802.png)
![Alt text](./1559461545898.png)
![Alt text](./1559461554384.png)
#####1.2.6、分布式服务接口的幂等性如何设计（比如不能重复扣款）？——》已理解
	1、面试官心理分析：
		从这个问题开始，面试官就已经进入了实际的生产问题的面试了。
	一个分布式系统中的某个接口，该如何保证幂等性？这个事儿其实是你做分布式系统的时候必须要考虑的一个生产环境的技术问题。啥意思呢？
	你看，假如你有个服务提供一些接口供外部调用，这个服务部署在了 5 台机器上，接着有个接口就是付款接口。然后人家用户在前端上操作的时候，不知道为啥，总之就是一个订单不小心发起了两次支付请求，然后这俩请求分散在了这个服务部署的不同的机器上，好了，结果一个订单扣款扣两次。
	或者是订单系统调用支付系统进行支付，结果不小心因为网络超时了，然后订单系统走了前面我们看到的那个重试机制，咔嚓给你重试了一把，好，支付系统收到一个支付请求两次，而且因为负载均衡算法落在了不同的机器上，尴尬了。。。
	所以你肯定得知道这事儿，否则你做出来的分布式系统恐怕容易埋坑
	2、面试题剖析：
![Alt text](./1559461678065.png)


#####1.2.7、分布式服务接口请求的顺序性如何保证？——》已理解（一致性hash，加入消息队列，强制排队）
	1、面试官心理分析：
	其实分布式系统接口的调用顺序，也是个问题，一般来说是不用保证顺序的。但是有时候可能确实是需要严格的顺序保证。给大家举个例子，你服务 A 调用服务 B，先插入再删除。好，结果俩请求过去了，落在不同机器上，可能插入请求因为某些原因执行慢了一些，导致删除请求先执行了，此时因为没数据所以啥效果也没有；结果这个时候插入请求过来了，好，数据插入进去了，那就尴尬了。
	本来应该是 “先插入 -> 再删除”，这条数据应该没了，结果现在 “先删除 -> 再插入”，数据还存在，最后你死都想不明白是怎么回事。
	所以这都是分布式系统一些很常见的问题。
	2、面试题剖析：
![Alt text](./1559463003607.png)
![Alt text](./1559463016688.png)


#####1.2.8、如何自己设计一个类似 Dubbo 的 RPC 框架？——》已理解（其中要涉及到动态代理）
	1、面试官心理分析：
	说实话，就这问题，其实就跟问你如何自己设计一个 MQ 一样的道理，就考两个：
	你有没有对某个 rpc 框架原理有非常深入的理解。
	你能不能从整体上来思考一下，如何设计一个 rpc 框架，考考你的系统设计能力。
	2、面试题剖析：
![Alt text](./1559463149865.png)

####1.3、分布式锁（Zookeeper）
#####1.3.1、zookeeper 都有哪些使用场景？——》已理解
	1、面试官心理分析
			现在聊的 topic 是分布式系统，面试官跟你聊完了 dubbo 相关的一些问题之后，已经确认你对分布式服务框架/RPC框架基本都有一些认知了。那么他可能开始要跟你聊分布式相关的其它问题了。
	

分布式锁这个东西，很常用的，你做 Java 系统开发，分布式系统，可能会有一些场景会用到。最常用的分布式锁就是基于 zookeeper 来实现的。

其实说实话，问这个问题，一般就是看看你是否了解 zookeeper，因为 zookeeper 是分布式系统中很常见的一个基础系统。而且问的话常问的就是说 zookeeper 的使用场景是什么？看你知道不知道一些基本的使用场景。但是其实 zookeeper 挖深了自然是可以问的很深很深的

2、面试题剖析

![Alt text](./1559465392063.png)
![Alt text](./1559465406404.png)
![Alt text](./1559465415592.png)
![Alt text](./1559465423205.png)

#####1.3.2、一般实现分布式锁都有哪些方式？使用 redis 如何设计分布式锁？使用 zk 来设计分布式锁可以吗？这两种分布式锁的实现方式哪种效率比较高？——》已理解
	1、面试官心理分析
		因为在分布式系统开发中，分布式锁的使用场景还是很常见的。
	2、面试题剖析：
![Alt text](./1559480159251.png)
![Alt text](./1559480180666.png)
![Alt text](./1559480213746.png)
[Zookeeper分布式锁](https://github.com/doocs/advanced-java/blob/master/docs/distributed-system/distributed-lock-redis-vs-zookeeper.md)

redis 分布式锁和 zk 分布式锁的对比
redis 分布式锁，其实需要自己不断去尝试获取锁，比较消耗性能。
zk 分布式锁，获取不到锁，注册个监听器即可，不需要不断主动尝试获取锁，性能开销较小。
另外一点就是，如果是 redis 获取锁的那个客户端 出现 bug 挂了，那么只能等待超时时间之后才能释放锁；而 zk 的话，因为创建的是临时 znode，只要客户端挂了，znode 就没了，此时就自动释放锁。

redis 分布式锁大家没发现好麻烦吗？遍历上锁，计算时间等等......zk 的分布式锁语义清晰实现简单。

所以先不分析太多的东西，就说这两点，我个人实践认为 zk 的分布式锁比 redis 的分布式锁牢靠、而且模型简单易用

####1.4、分布式事务
#####1.4.1、分布式事务了解吗？你们是如何解决分布式事务问题的？——》已理解
![Alt text](./1561950500329.png)
![Alt text](./1561950514879.png)
![Alt text](./1561950533231.png)
![Alt text](./1561950549466.png)
![Alt text](./1561950567460.png)
![Alt text](./1561950580399.png)

####1.5、分布式会话
#####1.5.1、集群部署时的分布式 session 如何实现？——》已理解
	1、面试官心理分析：
			面试官问了你一堆 dubbo 是怎么玩儿的，你会玩儿 dubbo 就可以把单块系统弄成分布式系统，然后分布式之后接踵而来的就是一堆问题，最大的问题就是分布式事务、接口幂等性、分布式锁，还有最后一个就是分布式 session。
	

当然了，分布式系统中的问题何止这么一点，非常之多，复杂度很高，这里只是说一下常见的几个问题，也是面试的时候常问的几个

2、面试题剖析：

![Alt text](./1559484217883.png)
![Alt text](./1559484230605.png)
![Alt text](./1559484241088.png)
![Alt text](./1559484253279.png)
